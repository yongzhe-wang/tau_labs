---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
import { siteConfig } from "../../site.config";
---

<header class="sticky top-0 z-50 w-full border-b border-gray-800 bg-global-bg/90 backdrop-blur-md" id="main-header">
	<div class="mx-auto flex h-16 max-w-7xl items-center justify-between px-4 sm:px-8">
		<a
			aria-current={Astro.url.pathname === "/" ? "page" : false}
			class="flex items-center gap-2"
			href="/"
		>
			<svg
				aria-hidden="true"
				class="h-8 w-8"
				fill="none"
				focusable="false"
				viewBox="0 30 240 260"
				xmlns="http://www.w3.org/2000/svg"
			>
				<title>Tau Labs Logo</title>
				<path
					fill="#cdffb8"
					d="M20 60 L50 30 L210 30 L180 60 Z M120 200 L150 170 L190 170 L160 200 Z"
				></path>
				<path
					fill="#d482ab"
					d="M20 60 L180 60 L180 100 L120 100 L120 200 L160 200 L160 240 L80 240 L80 100 L20 100 Z"
				></path>
				<path
					fill="#2abc89"
					d="M180 60 L210 30 L210 70 L180 100 Z M120 100 L150 70 L150 170 L120 200 Z M160 200 L190 170 L190 210 L160 240 Z"
				></path>
			</svg>
			<span class="text-xl font-bold text-text-primary">{siteConfig.title}</span>
		</a>

		<nav
			aria-label="Main menu"
			class="hidden md:flex items-center gap-4"
			id="navigation-menu"
		>
			{
				menuLinks.map((link) => (
					<a
						aria-current={Astro.url.pathname === link.path ? "page" : false}
						class="text-sm font-medium text-text-secondary hover:text-accent transition-colors whitespace-nowrap"
						href={link.path}
					>
						{link.title}
					</a>
				))
			}
		</nav>

		<div class="flex items-center gap-4">
			<a
				href="/contact"
				class="hidden md:inline-block bg-accent text-bgColor px-4 py-2 rounded text-sm font-bold hover:opacity-90 transition-opacity whitespace-nowrap"
			>
				Book a Consultation
			</a>
			<Search />
			<ThemeToggle />
			<mobile-button>
				<button
					aria-expanded="false"
					aria-haspopup="menu"
					class="group relative h-7 w-7 md:hidden"
					id="toggle-navigation-menu"
					type="button"
				>
					<span class="sr-only">Open main menu</span>
					<svg
						aria-hidden="true"
						class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
						fill="none"
						focusable="false"
						id="line-svg"
						stroke="currentColor"
						stroke-width="1.5"
						viewBox="0 0 24 24"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"
						></path>
					</svg>
					<svg
						aria-hidden="true"
						class="text-accent absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
						fill="none"
						focusable="false"
						id="cross-svg"
						stroke="currentColor"
						stroke-width="1.5"
						viewBox="0 0 24 24"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
					</svg>
				</button>
			</mobile-button>
		</div>
	</div>
	<!-- Mobile Menu Dropdown -->
	<div id="mobile-menu-content" class="hidden border-t border-gray-800 bg-global-bg px-4 py-4 md:hidden">
		<nav class="flex flex-col gap-4">
			{
				menuLinks.map((link) => (
					<a
						href={link.path}
						class="block text-lg font-medium hover:text-accent"
					>
						{link.title}
					</a>
				))
			}
			<a href="/contact" class="block text-lg font-bold text-accent mt-2">
				Book a Consultation
			</a>
		</nav>
	</div>
</header>

<script>
	class MobileButton extends HTMLElement {
		constructor() {
			super();
			const button = this.querySelector("button");
			const menu = document.getElementById("mobile-menu-content");

			button?.addEventListener("click", () => {
				const isExpanded = button.getAttribute("aria-expanded") === "true";
				button.setAttribute("aria-expanded", String(!isExpanded));
				menu?.classList.toggle("hidden");
			});
		}
	}
	customElements.define("mobile-button", MobileButton);
</script>
